# Authors: Pablo Cerezo Lesmes & Juan Sebasti??n Dur??n Dur??n
######################################################
#Por la fecha, el scraping se hizo siguiendo esta p??gina: https://datanalytics.com/libro_r/web-scraping.html
# 00. Data Acquisition #
#Cargamos los paquetes necesarios----------------------
install.packages("rvest")
library(rvest) # Para scraping
library(pacman)
p_load(rio) # Librer??a para importar datos
p_load(tidyverse) # Librer??a para limpiar datos
p_load(e1071) # Tiene la funci??n para calcular skewness
p_load(EnvStats) # Transformaci??n Box-Cox
p_load(tidymodels) # Modelos ML
p_load(ggplot2) # Librer??a para visualizar datos
p_load(scales) # Formato de los ejes en las gr??ficas
p_load(ggpubr) # Combinar gr??ficas
p_load(knitr) # Tablas dentro de Rmarkdown
p_load(kableExtra) # Tablas dentro de Rmarkdown
p_load(rvest)
rm(list = ls())
#Cargamos los paquetes necesarios----------------------
library(rio)
library(tidyverse)
library(e1071)
library(EnvStats)
library(tidymodels)
library(ggplot2)
library(scales)
library(ggpubr)
library(knitr)
library(kableExtra)
library(rvest)
library(pacman)
library(dplyr)
# 02. Data cleanning #
rm(list = ls())
#Cargamos los paquetes necesarios----------------------
library(tidyverse)
library(rvest)
library(pacman)
library(dplyr)
library(readr, warn.conflicts = FALSE)
#Cargamos la data--------------------------------------
GEIH <- data.frame()
for (i in 1:10){
url <-paste0("https://ignaciomsarmiento.github.io/GEIH2018_sample/pages/geih_page_",i,".html")
temp <- read_html(url)%>%
html_table()
temp <- as.data.frame(temp)
GEIH <- rbind(GEIH,temp)
}
#2.1 Variables de interÃ©s------------------------------
#Dejamos mayores de edad y trabajadores
GEIH_ocupados<-data.frame()
GEIH_ocupados<-subset(GEIH, age>=18 & ocu==1)
#Creamos interacciones de variables de interÃ©s
GEIH_ocupados <- GEIH_ocupados %>%
mutate(age2 = age^2,
age_sex = age*sex,
age_sex2 = age2*sex,
log_Ing = log(ingtot),
formal_sex = formal*sex,
realb_sex = relab*sex,
)
#Creamos el df con las variables de interÃ©s
GEIH_clean <- subset(GEIH_ocupados, select = c (sex, ingtot, age, age2,
age_sex, age_sex2, formal,
relab,maxEducLevel, depto,
clase, p6426, log_Ing, formal_sex,
realb_sex))
#Creamos aÃ±os de educaciÃ³n segÃºn mÃ¡ximo nivel educativo alcanzado
GEIH_clean <- GEIH_clean %>%
mutate(aÃ±os_educ=0
)
#Creamos aÃ±os de educaciÃ³n segÃºn mÃ¡ximo nivel educativo alcanzado
GEIH_clean <- GEIH_clean %>%
mutate(educ=0
)
GEIH_clean <- replace(GEIH_clean$educ, GEIH_clean$maxEducLevel==3,4)
#Creamos el df con las variables de interÃ©s
GEIH_clean <- subset(GEIH_ocupados, select = c (sex, ingtot, age, age2,
age_sex, age_sex2, formal,
relab,maxEducLevel, depto,
clase, p6426, log_Ing, formal_sex,
realb_sex))
#Creamos aÃ±os de educaciÃ³n segÃºn mÃ¡ximo nivel educativo alcanzado
GEIH_clean <- GEIH_clean %>%
mutate(educ=0
)
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 3] <- 4
max(GEIH_clean$educ)
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 3] <- 4
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 4] <- 5
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 5] <- 10
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 6] <- 11
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 7] <- 15
max(GEIH_clean$educ)
View(GEIH_clean)
summary(GEIH_clean$educ)
mutate(educ=0
)
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 3] <- 4
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 4] <- 5
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 5] <- 10
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 6] <- 11
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 7] <- 15
summary(GEIH_clean$educ)
GEIH_clean <- GEIH_clean  %>%
mutate(educ=0)
View(GEIH_clean)
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 3] <- 4
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 4] <- 5
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 5] <- 10
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 6] <- 11
GEIH_clean['educ'][GEIH_clean['maxEducLevel'] == 7] <- 15
summary(GEIH_clean$educ)
modelo1 <- lm(ingtot ~ age + age2,
data = GEIH_clean)
summary(modelo1)
huxreg(modelo1)
install.packages(stargazer)
install.packages("stargazer")
install.packages("stargazer")
library(stargazer)
stargazer(modelo1)
install.packages("broom")
install.packages("broom")
library(broom)
huxreg(modelo1)
library(huxtable)
install.packages("huxtable")
library(huxtable)
huxreg(modelo1)
install.packages("ggplot2")
library(ggplot2)
ggplot(GEIH_clean, aes(x=age, y=ingtot))+geom_point()
predict(modelo1)
GEIH_clean <- GEIH_clean %>%
mutate(ingtotpr = predict(modelo1))
library(tidyverse)
GEIH_clean <- GEIH_clean %>%
mutate(ingtotpr = predict(modelo1))
ggplot(GEIH_clean, aes(x=age, y=ingtot))+geom_point() + geom_smooth(method = "lm")
ggplot(GEIH_clean, aes(x=age, y=ingtotpr))+geom_point() + geom_smooth(method = "lm")
summary(ingtotpr)
View(GEIH)
CreateTableOne(data = GEIH_clean, vars = c("sex","ingtot","age","formal","clase","educ"))
library(tidyverse)
library(dplyr)
library(huxtable)
CreateTableOne(data = GEIH_clean, vars = c("sex","ingtot","age","formal","clase","educ"))
vardesc <- c("sex","ingtot","age","formal","clase","educ")
library(broom)
library(tableone)
install.packages("tableone")
library(tableone)
CreateTableOne(data = GEIH_clean, vars = vardesc))
CreateTableOne(data = GEIH_clean, vars = vardesc)
library(huxtable)
huxtable::as_huxtable(GEIH_clean, vars = vardesc)
install.packages("tableone")
library(tableone)
CreateTableOne(data = GEIH_clean, vars = vardesc)
vardesc <- c("sex","ingtot","age","formal","clase","educ")
CreateTableOne(data = GEIH_clean, vars = vardesc)
tabla1 <- CreateTableOne(data = GEIH_clean, vars = vardesc)
tabla1
install.packages("writexl")
library(writexl)
write_xlsx(tabla1,"tabla1.xlsx")
ggplot(GEIH_clean, aes(x=age, y= preidict(modelo1))) + geom_point() + labs(x='NOMBRE_EJE_X', y='NOMBRE_EJE_Y, title='NOMBRE_GRAFICO')
rm(list = ls())
library(tidyverse)
library(rvest)
library(pacman)
library(dplyr)
library(readr, warn.conflicts = FALSE)
library(broom)
#Cargamos la data--------------------------------------
GEIH <- data.frame()
for (i in 1:10){
url <-paste0("https://ignaciomsarmiento.github.io/GEIH2018_sample/pages/geih_page_",i,".html")
temp <- read_html(url)%>%
html_table()
temp <- as.data.frame(temp)
GEIH <- rbind(GEIH,temp)
GEIH <- data.frame()
for (i in 1:10){
url <-paste0("https://ignaciomsarmiento.github.io/GEIH2018_sample/pages/geih_page_",i,".html")
temp <- read_html(url)%>%
html_table()
temp <- as.data.frame(temp)
GEIH <- rbind(GEIH,temp)
GEIH <- data.frame()
for (i in 1:10){
url <-paste0("https://ignaciomsarmiento.github.io/GEIH2018_sample/pages/geih_page_",i,".html")
temp <- read_html(url)%>%
html_table()
temp <- as.data.frame(temp)
GEIH <- rbind(GEIH,temp)
}
rm(list = ls())
View(GEIH_ocupados)
install.packages("tableone")
library(tableone)
vardesc <- c("sex","ingtot","age","formal","clase","educ", "dmonio", "p6424","relab")
tabla1 <- CreateTableOne(data = GEIH_clean, vars = vardesc)
tabla1
install.packages("writexl")
install.packages("huxtable")
huxtable(tabla1)
library(huxtable)
huxtable(tabla1)
tabla1 <- data.frame()
tabla1
huxtable(tabla1)
summary(vardesc)
data.frame(table(GEIH_clean$female))
install.packages("tableone")
library(tableone)
vardesc <- c("sex","ingtot","age","formal","clase","educ")
tabla1 <- CreateTableOne(data = GEIH_clean, vars = vardesc)
tabla1
vardesc <- c("sex","ingtot","age","formal","clase","educ","p6426", "relab")
tabla1 <- CreateTableOne(data = GEIH_clean, vars = vardesc)
tabla1
GEIH:clean %>%
rename(p6426 = tiempo_tra)
library(tidyverse)
library(dplyr)
GEIH:clean %>%
rename(p6426 = tiempo_tra)
GEIH_clean %>%
rename(p6426 = tiempo_tra)
GEIH_clean %>%
rename(  tiempo_tra = p6426)
GEIH_clean %>%
rename(tiempo_tra = p6426, tipo_ocu  = relab, urbano = clase)
GEIH_clean  <- rename(tiempo_tra = p6426, tipo_ocu  = relab, urbano = clase)
GEIH_clean <- GEIH_clean %>%
rename(tiempo_tra = p6426, tipo_ocu  = relab, urbano = clase)
summay(GEIH_clean)
summary(GEIH_clean)
skim(GEIH_clean)
install.packages("skim")
library(skim)
library(skimr)
skim(GEIH_clean)
table(GEIH_clean$educ)
install.packages("ggplot2")
install.packages("ggplot2")
library(ggplot2)
ggplot(GEIH_clean, aes(x = ingtot)) + geom_histogram()
ggplot(GEIH_clean, aes(x= as.factor(educ))) + geom_bar(width=0.5, colour="red", fill="skyblue") +
geom_text(aes(label=..count..), stat='count',position=position_dodge(0.9), vjust=-0.5,  size=5.0)
ggplot(GEIH_clean, aes(x= as.factor(sex))) + geom_bar(width=0.5, colour="red", fill="skyblue") +
geom_text(aes(label=..count..), stat='count',position=position_dodge(0.9), vjust=-0.5,  size=5.0)
ggplot(GEIH_clean, aes(x= as.factor(educ,sex))) + geom_bar(width=0.5, colour="red", fill="skyblue") +
geom_text(aes(label=..count..), stat='count',position=position_dodge(0.9), vjust=-0.5,  size=5.0)
ggplot(GEIH_clean, aes(x= as.factor(educ, fill = sex))) + geom_bar(width=0.5, colour="red", fill="skyblue") +
geom_text(aes(label=..count..), stat='count',position=position_dodge(0.9), vjust=-0.5,  size=5.0)
ggplot(GEIH_clean, aes(x= as.factor(educ), fill = sex )) + geom_bar(width=0.5, colour="red", fill="skyblue") +
geom_text(aes(label=..count..), stat='count',position=position_dodge(0.9), vjust=-0.5,  size=5.0)
as.datatable_widget(a)
install.packages("descr")
library(descr)
descr(GEIH_clean$ingtot)
GEIH_clean %>%
crosstab(educ, sex)
library(dplyr)
GEIH_clean %>%
crosstab(educ, sex)
crosstab(GEIH_clean$educ, GEIH_clean$sex)
crosstab(GEIH_clean$educ, GEIH_clean$sex, prop.c = TRUE)
factor(GEIH_clean$educ)
factor(GEIH_clean, levels = c("0", "4", "5", "10","11", "15" ))
factor(educ, levels = c("0", "4", "5", "10","11", "15"))
factor(GEIH_clean$educ, levels = c("0", "4", "5", "10","11", "15"))
labels(GEIH_clean$female) <- list("0" = "Hombre",
"1" = "Mujer")
library(tidyverse)
library(dplyr)
labels(GEIH_clean$female) <- list("0" = "Hombre",
"1" = "Mujer")
factor(GEIH_clean$educ,
labels = c("Ninguno", "Primaria_inc", "Primaria_com", "Secundaria_inc","Secundaria_com", "Educ_superior"))
ggplot(GEIH_clean, aes(x= as.factor(educ), fill = sex )) + geom_bar(width=0.5, colour="red", fill="skyblue") +
geom_text(aes(label=..count..), stat='count',position=position_dodge(0.9), vjust=-0.5,  size=5.0)
ggplot(GEIH_clean, aes(x= educ, fill = sex )) + geom_bar(width=0.5, colour="red", fill="skyblue") +
geom_text(aes(label=..count..), stat='count',position=position_dodge(0.9), vjust=-0.5,  size=5.0)
GEIH_clean <- factor(GEIH_clean$educ,
labels = c("Ninguno", "Primaria_inc", "Primaria_com", "Secundaria_inc","Secundaria_com", "Educ_superior"))
ggplot(GEIH_clean, aes(x= as.factor(educ), fill = sex )) + geom_bar(width=0.5, colour="red", fill="skyblue") +
geom_text(aes(label=..count..), stat='count',position=position_dodge(0.9), vjust=-0.5,  size=5.0)
library(ggplot2
ggplot(GEIH_clean, aes(x= as.factor(educ), fill = sex )) + geom_bar(width=0.5, colour="red", fill="skyblue") +
geom_text(aes(label=..count..), stat='count',position=position_dodge(0.9), vjust=-0.5,  size=5.0)
install.packages("ggplot2")
library(ggplot2)
ggplot(GEIH_clean, aes(x= as.factor(educ), fill = sex )) + geom_bar(width=0.5, colour="red", fill="skyblue") +
geom_text(aes(label=..count..), stat='count',position=position_dodge(0.9), vjust=-0.5,  size=5.0)
factor(GEIH_clean$educ)
grafica <- GEIH_clean
grafica <- add_labels(grafica$educ, labels = c( `Sin_educ`= 0,
`Primaria_inc` = 4,
`Primaria_com` = 5,
`Secundaria_inc`= 10,
`Secundaria_com`= 11,
`Terciaria` = 15))
library(tidyverse)
library(rvest)
library(pacman)
library(dplyr)
library(readr, warn.conflicts = FALSE)
library(broom)
grafica <- add_labels(grafica$educ, labels = c( `Sin_educ`= 0,
`Primaria_inc` = 4,
`Primaria_com` = 5,
`Secundaria_inc`= 10,
`Secundaria_com`= 11,
`Terciaria` = 15))
grafica = factor(c(0,4,5,10,11,15),labels=c("Ninguno", "Primaria_inc", "Primaria_com", "Secundaria_inc", "Secundaria_com", "Educacion_sup"))
grafica <- GEIH_clean
grafica <- factor(c(0,4,5,10,11,15),labels=c("Ninguno", "Primaria_inc", "Primaria_com", "Secundaria_inc", "Secundaria_com", "Educacion_sup"))
grafica <- GEIH_clean
grafica$educ <- factor(c(0,4,5,10,11,15),labels=c("Ninguno", "Primaria_inc", "Primaria_com", "Secundaria_inc", "Secundaria_com", "Educacion_sup"))
modelo1 <- lm(ingtot ~ age + age2,
data = GEIH_clean)
summary(modelo1)
